<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Email Garantias</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }
        .success { color: #10B981; font-weight: bold; }
        .error { color: #EF4444; font-weight: bold; }
        .info { color: #3B82F6; }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Checklist de Teste - Emails de Garantias</h1>
        
        <div class="test-section">
            <h2>1. ‚úÖ Verificar Migration Executada</h2>
            <p>Execute no banco de dados:</p>
            <code>
                SHOW COLUMNS FROM garantias LIKE 'usuario_notificado_id';<br>
                SHOW TABLES LIKE 'garantias_historico_status';
            </code>
            <p class="info">‚úì Deve retornar as colunas/tabelas criadas</p>
        </div>

        <div class="test-section">
            <h2>2. ‚úÖ Verificar Configura√ß√£o SMTP</h2>
            <p>Configura√ß√£o no arquivo <code>.env</code>:</p>
            <ul>
                <li>MAIL_HOST=smtp.hostinger.com</li>
                <li>MAIL_PORT=465</li>
                <li>MAIL_USERNAME=suporte@djbr.sgqoti.com.br</li>
                <li>MAIL_PASSWORD=(senha configurada)</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>3. ‚úÖ Criar/Atualizar Garantia com Notifica√ß√£o</h2>
            <p><strong>Passos:</strong></p>
            <ol>
                <li>Acesse: <code>https://djbr.sgqoti.com.br/garantias</code></li>
                <li>Crie uma nova garantia OU edite uma existente</li>
                <li>Selecione um usu√°rio no campo <strong>üîî Notificar Algu√©m</strong></li>
                <li>Salve a garantia</li>
                <li>Mude o status da garantia</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>4. ‚úÖ Verificar Logs do Servidor</h2>
            <p>Verificar no arquivo de error_log do PHP:</p>
            <ul>
                <li class="success">‚úÖ "üìß Preparando email de notifica√ß√£o para: [email]"</li>
                <li class="success">‚úÖ "=== TENTANDO ENVIAR EMAIL ==="</li>
                <li class="success">‚úÖ "‚úÖ Email de garantia enviado com sucesso"</li>
                <li class="error">‚ùå Se aparecer erro SMTP, verificar credenciais</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>5. ‚úÖ Verificar Hist√≥rico no Banco</h2>
            <p>Execute no banco:</p>
            <code>
                SELECT * FROM garantias_historico_status ORDER BY data_mudanca DESC LIMIT 10;
            </code>
            <p class="info">‚úì Deve mostrar mudan√ßas de status registradas</p>
        </div>

        <div class="test-section">
            <h2>6. ‚úÖ Verificar Email Recebido</h2>
            <p><strong>O email deve conter:</strong></p>
            <ul>
                <li>Assunto: "SGQ - Garantia #XX - Status Atualizado üîî"</li>
                <li>Nome do usu√°rio notificado</li>
                <li>Status atual da garantia</li>
                <li>Detalhes: Fornecedor, NF, Ticket</li>
                <li>Link para ver detalhes completos</li>
                <li>Design bonito com gradiente roxo</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>7. ‚úÖ Verificar P√°gina de Detalhes</h2>
            <p>Acesse: <code>/garantias/{id}/detalhes</code></p>
            <p><strong>Deve exibir:</strong></p>
            <ul>
                <li>Informa√ß√µes b√°sicas da garantia</li>
                <li>Itens da garantia com produtos</li>
                <li>Hist√≥rico REAL de status com datas</li>
                <li>Tempo calculado por cada status</li>
                <li>Informa√ß√£o do usu√°rio notificado</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>üìä Comandos SQL √öteis</h2>
            <p><strong>Ver garantias com usu√°rio notificado:</strong></p>
            <code>
                SELECT g.id, g.status, u.name, u.email <br>
                FROM garantias g<br>
                LEFT JOIN users u ON g.usuario_notificado_id = u.id<br>
                WHERE g.usuario_notificado_id IS NOT NULL;
            </code>
            
            <p><strong>Ver hist√≥rico de uma garantia espec√≠fica:</strong></p>
            <code>
                SELECT h.*, u.name as usuario<br>
                FROM garantias_historico_status h<br>
                LEFT JOIN users u ON h.usuario_id = u.id<br>
                WHERE h.garantia_id = 1<br>
                ORDER BY h.data_mudanca DESC;
            </code>
        </div>

        <div class="test-section">
            <h2>üêõ Troubleshooting</h2>
            <p><strong>Se o email n√£o chegou:</strong></p>
            <ol>
                <li>Verificar se migration foi executada</li>
                <li>Verificar se usu√°rio foi selecionado no campo de notifica√ß√£o</li>
                <li>Verificar logs do PHP (error_log)</li>
                <li>Verificar credenciais SMTP no .env</li>
                <li>Verificar se o status foi REALMENTE alterado</li>
                <li>Verificar caixa de SPAM do email</li>
                <li>Testar envio manual via EmailService</li>
            </ol>
        </div>

        <div class="test-section" style="background: #d1fae5; border-color: #10B981;">
            <h2>‚úÖ Sistema de Notifica√ß√µes Implementado</h2>
            <p><strong>Funcionalidades:</strong></p>
            <ul>
                <li>‚úÖ Campo de sele√ß√£o de usu√°rio no formul√°rio</li>
                <li>‚úÖ Registro autom√°tico de hist√≥rico de status</li>
                <li>‚úÖ Envio de email REAL usando EmailService</li>
                <li>‚úÖ Template HTML profissional</li>
                <li>‚úÖ P√°gina de detalhes com tempo real por status</li>
                <li>‚úÖ Link direto no email para p√°gina de detalhes</li>
            </ul>
        </div>
    </div>
</body>
</html>
